---
layout: post
title: nginxで特定のパスを別なポートにリダイレクトする
tags:
- Linux

---
{% raw %}
<p>一般的にはリバースプロキシというらしいです。<br />
<a class="keyword" href="http://d.hatena.ne.jp/keyword/Rails">Rails</a>で作ったものを12345番ポート、Yesodで作ったものを12346番ポート、Playで作ったものを12347番ポートで公開して、<br />
<a class="keyword" href="http://d.hatena.ne.jp/keyword/example.com">example.com</a>/<a class="keyword" href="http://d.hatena.ne.jp/keyword/rails">rails</a>で<a class="keyword" href="http://d.hatena.ne.jp/keyword/example.com">example.com</a>:12345, <a class="keyword" href="http://d.hatena.ne.jp/keyword/example.com">example.com</a>/yesodで<a class="keyword" href="http://d.hatena.ne.jp/keyword/example.com">example.com</a>:12346, <a class="keyword" href="http://d.hatena.ne.jp/keyword/example.com">example.com</a>/playで<a class="keyword" href="http://d.hatena.ne.jp/keyword/example.com">example.com</a>:12347に飛ぶように、nginxでいい感じにリダイレクトさせたい場合の設定です。</p>
<pre class="code" data-lang="" data-unlink>http {
  ...
  server {
    ...
    location /rails/ {
      rewrite ^/(.+) $1 break;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header Host $http_host;
      proxy_redirect off;
      proxy_pass http://127.0.0.1:12345/$1$is_args$args;
    }
  }
  location /yesod/ {
      rewrite ^/(.+) $1 break;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header Host $http_host;
      proxy_redirect off;
      proxy_pass http://127.0.0.1:12346/$1$is_args$args;
    }
  }
  location /play/ {
      rewrite ^/(.+) $1 break;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header Host $http_host;
      proxy_redirect off;
      proxy_pass http://127.0.0.1:12347/$1$is_args$args;
    }
  }
}</pre>

{% endraw %}
