---
layout: post
title: 教養としてCOBOLに触れてみる
tags:
- Others

---
{% raw %}
<p>教養として一度くらい<a class="keyword" href="http://d.hatena.ne.jp/keyword/COBOL">COBOL</a>に触れてみなければダメなんじゃないかと思ったので、<a class="keyword" href="http://d.hatena.ne.jp/keyword/COBOL">COBOL</a>入門として<a class="keyword" href="http://d.hatena.ne.jp/keyword/Fizz">Fizz</a> Buzzを書いてみました。</p><p>コードはこちら。</p>
<pre class="code lang-cobol" data-lang="cobol" data-unlink><span class="synError">000010</span> <span class="synStatement">IDENTIFICATION DIVISION</span>.                                         <span class="synError">this</span>
<span class="synError">000020</span> <span class="synStatement">PROGRAM-ID</span>. FIZZBUZZ.                                            <span class="synError">is</span>
<span class="synError">000030</span> <span class="synStatement">AUTHOR</span>. HOGE.                                                    <span class="synError">a</span>
<span class="synError">000040</span> <span class="synStatement">DATE-WRITTEN</span>. 2017/01/13.                                        <span class="synError">comment.</span>
<span class="synError">000050</span> <span class="synStatement">DATE-COMPILED</span>. 2017/01/13.
<span class="synError">000060</span><span class="synComment">*</span>
<span class="synError">000070</span> <span class="synStatement">ENVIRONMENT DIVISION</span>.
<span class="synError">000080</span> <span class="synStatement">CONFIGURATION SECTION</span>.
<span class="synError">000090</span> <span class="synStatement">SOURCE-COMPUTER</span>. HOGE.
<span class="synError">000100</span> <span class="synStatement">OBJECT-COMPUTER</span>. HOGE.
<span class="synError">000110</span><span class="synComment">*</span>
<span class="synError">000120</span> <span class="synStatement">DATA DIVISION</span>.
<span class="synError">000130</span> <span class="synStatement">WORKING-STORAGE SECTION</span>.
<span class="synError">000140</span> <span class="synType">77 </span>I <span class="synStatement">PIC</span> <span class="synConstant">999</span>.
<span class="synError">000150</span> <span class="synType">77 </span>R <span class="synStatement">PIC</span> <span class="synConstant">99</span>.
<span class="synError">000160</span><span class="synComment">*</span>
<span class="synError">000170</span> <span class="synStatement">PROCEDURE DIVISION</span>.
<span class="synError">000180</span> <span class="synStatement">MAIN</span>.
<span class="synError">000190</span><span class="synComment">*</span>
<span class="synError">000200</span><span class="synComment">* this is also a comment.</span>
<span class="synError">000210</span><span class="synComment">*</span>
<span class="synError">000220</span> <span class="synStatement">MOVE</span> <span class="synConstant">1</span> <span class="synStatement">TO</span> I.
<span class="synError">000230</span> <span class="synIdentifier">PERFORM</span> <span class="synStatement">UNTIL</span> I &gt; <span class="synConstant">100</span>
<span class="synError">000240</span><span class="synSpecial">     </span><span class="synStatement">COMPUTE</span> R = FUNCTION REM(I, <span class="synConstant">15</span>)
<span class="synError">000250</span><span class="synSpecial">     </span><span class="synStatement">IF</span> R = <span class="synConstant">0</span> <span class="synStatement">THEN</span>
<span class="synError">000260</span><span class="synSpecial">         </span><span class="synStatement">DISPLAY</span> <span class="synConstant">&quot;Fizz Buzz&quot;</span>
<span class="synError">000270</span><span class="synSpecial">     </span><span class="synStatement">ELSE</span>
<span class="synError">000280</span><span class="synSpecial">         </span><span class="synStatement">COMPUTE</span> R = FUNCTION REM(I, <span class="synConstant">3</span>)
<span class="synError">000290</span><span class="synSpecial">         </span><span class="synStatement">IF</span> R = <span class="synConstant">0</span> <span class="synStatement">THEN</span>
<span class="synError">000300</span><span class="synSpecial">             </span><span class="synStatement">DISPLAY</span> <span class="synConstant">&quot;Fizz&quot;</span>
<span class="synError">000310</span><span class="synSpecial">         </span><span class="synStatement">ELSE</span>
<span class="synError">000320</span><span class="synSpecial">             </span><span class="synStatement">COMPUTE</span> R = FUNCTION REM(I, <span class="synConstant">5</span>)
<span class="synError">000330</span><span class="synSpecial">             </span><span class="synStatement">IF</span> R = <span class="synConstant">0</span> <span class="synStatement">THEN</span>
<span class="synError">000340</span><span class="synSpecial">                 </span><span class="synStatement">DISPLAY</span> <span class="synConstant">&quot;Buzz&quot;</span>
<span class="synError">000350</span><span class="synSpecial">             </span><span class="synStatement">ELSE</span>
<span class="synError">000360</span><span class="synSpecial">                 </span><span class="synStatement">DISPLAY</span> I
<span class="synError">000370</span><span class="synSpecial">             </span><span class="synStatement">END-IF</span>
<span class="synError">000380</span><span class="synSpecial">         </span><span class="synStatement">END-IF</span>
<span class="synError">000390</span><span class="synSpecial">     </span><span class="synStatement">END-IF</span>
<span class="synError">000400</span><span class="synSpecial">     </span><span class="synStatement">ADD</span> <span class="synConstant">1</span> <span class="synStatement">TO</span> I
<span class="synError">000410</span> <span class="synStatement">END-PERFORM</span>.
<span class="synError">000420</span> <span class="synStatement">STOP</span> <span class="synSpecial">RUN</span>.
</pre><p>見るからに異様というか、圧倒的に現在主流のプログラムのコードとはかけ離れた見た目をしています。<br />
先頭から順番に見ていきましょう。</p>
<pre class="code lang-cobol" data-lang="cobol" data-unlink><span class="synError">000010</span> <span class="synStatement">IDENTIFICATION DIVISION</span>.                                         <span class="synError">this</span>
<span class="synError">000020</span> <span class="synStatement">PROGRAM-ID</span>. FIZZBUZZ.                                            <span class="synError">is</span>
<span class="synError">000030</span> <span class="synStatement">AUTHOR</span>. HOGE.                                                    <span class="synError">a</span>
<span class="synError">000040</span> <span class="synStatement">DATE-WRITTEN</span>. 2017/01/13.                                        <span class="synError">comment.</span>
</pre><p>各行の先頭1〜6文字目は行番号になっています。あとから行を挿入しやすいように10飛ばしにしてる所が泣けてきますね。<br />
ただ、最近の処理系は書かれた行番号を無視するらしいので、この部分は実質無意味なようです。</p><p>各行の7文字目はその行の種類を表します。スペースならプログラムの一部。<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A2%A5%B9%A5%BF%A5%EA%A5%B9%A5%AF">アスタリスク</a>はコメント、ハイフンなら前の行の続きです。<br />
したがって、</p>
<pre class="code lang-cobol" data-lang="cobol" data-unlink><span class="synError">000190</span><span class="synComment">*</span>
<span class="synError">000200</span><span class="synComment">* this is also a comment.</span>
<span class="synError">000210</span><span class="synComment">*</span>
</pre><p>この部分は全てコメントになっています。*から行末までがコメントというわけではなく、その行の7文字目が*であればその行がコメントになるだけという仕様が素晴らしいですね。</p><p>8〜72文字目がプログラム本体で、73〜80文字目はコメントです。従って、最初の4行の右端にある</p>
<pre class="code lang-ocaml" data-lang="ocaml" data-unlink>this
is
a
comment.
</pre><p>はすべてコメントになります。</p><p>以上の合計80文字によりプログラムの行が構成されます。なお、1行に81文字以上書くことは許されません。コーディングスタイルとして行ごとの文字数を80〜85文字程度に抑えるのはよくあることですが、それが言語仕様として強制されているのは面白いですね。</p><br />
<p>以上が<a class="keyword" href="http://d.hatena.ne.jp/keyword/COBOL">COBOL</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>における各行の意味でした。以上の要求を満たす行を並べることで、<a class="keyword" href="http://d.hatena.ne.jp/keyword/COBOL">COBOL</a>のプログラムを書くことができます。<br />
<a class="keyword" href="http://d.hatena.ne.jp/keyword/COBOL">COBOL</a>のプログラムは4つのDIVISIONからなります。</p><p>IDENTIFICATION DIVISION<br />
このDIVISIONにはプログラムの<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%E1%A5%BF%A5%C7%A1%BC%A5%BF">メタデータ</a>が書かれています。<br />
プログラム名、作者、書かれた日付、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%EB">コンパイル</a>された日付などを書きます。<br />
更新日や<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%EB">コンパイル</a>された日付くらい自動で管理してほしいものですが、<a class="keyword" href="http://d.hatena.ne.jp/keyword/COBOL">COBOL</a>が作られた当時はそうもいかなかったのでしょう。<br />
<a class="keyword" href="http://d.hatena.ne.jp/keyword/COBOL">COBOL</a>で開発を行っている人たちは、プログラムの修正が完了していざ<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%EB">コンパイル</a>となった時に全員総出でDATE-COMPILEDの更新を行ったりしているのでしょうか。少しシュールですね。</p><p>ENVIRONMENT DIVISION<br />
このDIVISIONには、実行環境についての情報が書かれています。<br />
プログラムを<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A5%F3%A5%D1%A5%A4%A5%EB">コンパイル</a>するマシン名、実行するマシン名、プログラムからアクセスするファイルの情報などを書きます。<br />
実行するマシン名が固定というのは、現在からすると考えられませんね。</p><p>DATA DIVISION<br />
このDIVISIONでは、プログラムからアクセスするファイルの書式や、プログラム内で使用する変数の定義などを行います。<br />
このプログラムでは2つの変数、IとRを定義しています。</p>
<pre class="code lang-cobol" data-lang="cobol" data-unlink><span class="synError">000140</span> <span class="synType">77 </span>I <span class="synStatement">PIC</span> <span class="synConstant">999</span>.
<span class="synError">000150</span> <span class="synType">77 </span>R <span class="synStatement">PIC</span> <span class="synConstant">99</span>.
</pre><p>先頭にある'77'は変数の種類。この数字を変えることで、構造体やそのプロパティ等も定義できるらしいです。なぜ77なのかは謎。<br />
PICの後にある999, 99は変数の型を表しています。「999」で3桁の10進数、「99」で3桁の10進数を表します。9999999999のかわりに9(10)とか書いたりもできます。ちなみに、777と書いたからといって8進数になるわけでは無さそうです。</p><p>PROCEDURE DIVISION<br />
ここからがプログラム本体です。17行目からようやくプログラムが始まります。</p>
<pre class="code lang-cobol" data-lang="cobol" data-unlink><span class="synError">000170</span> <span class="synStatement">PROCEDURE DIVISION</span>.
<span class="synError">000180</span> <span class="synStatement">MAIN</span>.
</pre><p>プログラム本体が何をやっているかはまあ読めばわかると思うので、特に解説はしません。<br />
しかし、(ある程度冗長に書いているとは言え、)たかが<a class="keyword" href="http://d.hatena.ne.jp/keyword/FizzBuzz">FizzBuzz</a>を書くためにこれだけのことを書かなければいけないというのは驚きですね。現在実用的に使われている言語の中で最も書き方が冗長になる言語の1つが<a class="keyword" href="http://d.hatena.ne.jp/keyword/Java">Java</a>ですが、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Java">Java</a>による同様の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A2%A5%EB%A5%B4%A5%EA%A5%BA%A5%E0">アルゴリズム</a>の<a class="keyword" href="http://d.hatena.ne.jp/keyword/Fizz">Fizz</a> Buzzを書いてみると、</p>
<pre class="code lang-java" data-lang="java" data-unlink><span class="synType">class</span> FizzBuzz {
    <span class="synType">public</span> <span class="synType">static</span> <span class="synType">void</span> main(String[] args) {
        <span class="synStatement">for</span> (<span class="synType">int</span> i = <span class="synConstant">1</span>; i &lt;= <span class="synConstant">100</span>; i++) {
            <span class="synStatement">if</span> (i % <span class="synConstant">15</span> == <span class="synConstant">0</span>) {
                System.out.println(<span class="synConstant">&quot;Fizz Buzz&quot;</span>);
            } <span class="synStatement">else</span> <span class="synStatement">if</span> (i % <span class="synConstant">3</span> == <span class="synConstant">0</span>) {
                System.out.println(<span class="synConstant">&quot;Fizz&quot;</span>);
            } <span class="synStatement">else</span> <span class="synStatement">if</span> (i % <span class="synConstant">5</span> == <span class="synConstant">0</span>) {
                System.out.println(<span class="synConstant">&quot;Buzz&quot;</span>);
            } <span class="synStatement">else</span> {
                System.out.println(i);
            }
        }
    }
}
</pre><p>15行で収まりました。もっと簡潔な文法の言語、例えば<a class="keyword" href="http://d.hatena.ne.jp/keyword/Haskell">Haskell</a>なら、</p>
<pre class="code lang-haskell" data-lang="haskell" data-unlink><span class="synSpecial">{-# LANGUAGE MultiWayIf #-}</span>
<span class="synPreProc">import</span> Control.Monad
main <span class="synStatement">=</span> forM_ [<span class="synConstant">1</span><span class="synStatement">..</span><span class="synConstant">100</span>] <span class="synStatement">$</span> <span class="synStatement">\</span>i <span class="synStatement">-&gt;</span> <span class="synStatement">do</span>
  putStrLn <span class="synStatement">$</span> <span class="synStatement">if</span> <span class="synStatement">|</span> i <span class="synStatement">%</span> <span class="synConstant">15</span> <span class="synStatement">==</span> <span class="synConstant">0</span> <span class="synStatement">-&gt;</span> <span class="synConstant">&quot;Fizz Buzz&quot;</span>
                <span class="synStatement">|</span> i <span class="synStatement">%</span> <span class="synConstant">3</span>  <span class="synStatement">==</span> <span class="synConstant">0</span> <span class="synStatement">-&gt;</span> <span class="synConstant">&quot;Fizz&quot;</span>
                <span class="synStatement">|</span> i <span class="synStatement">%</span> <span class="synConstant">5</span>  <span class="synStatement">==</span> <span class="synConstant">0</span> <span class="synStatement">-&gt;</span> <span class="synConstant">&quot;Buzz&quot;</span>
                <span class="synStatement">|</span> otherwise   <span class="synStatement">-&gt;</span> show i
</pre><p>import文とLANGUAGEプラグマを入れても7行、実質5行で書くことができます。<br />
僕は<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B3%A1%BC%A5%C9%A5%B4%A5%EB%A5%D5">コードゴルフ</a>ァーでも<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%DD%A1%BC%A5%EB%A5%B0%A5%EC%A5%A2%A5%E0">ポールグレアム</a>でもないので短く簡潔に書けることこそがいい言語である条件だとは言いませんが、同じ<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%A2%A5%EB%A5%B4%A5%EA%A5%BA%A5%E0">アルゴリズム</a>を書いた時のコードの長さは、その言語を使った時の生産性を測る指標にはなると思います。<br />
<a class="keyword" href="http://d.hatena.ne.jp/keyword/COBOL">COBOL</a>ほど冗長にプログラムを書かなければならない言語も珍しいでしょう。金融系などのミスが許されない環境だからこそ、冗長に書かなければならないというのもあるのでしょうが。</p>


{% endraw %}
