---
layout: post
title: Gaucheでパラメータを定義する
tags:
- Gauche

---
{% raw %}
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Gauche">Gauche</a>には、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B0%A5%ED%A1%BC%A5%D0%A5%EB%CA%D1%BF%F4">グローバル変数</a>の代わりに使用できるパラメータというオブジェクトが存在します。</p>

<div class="section">
    <h4>パラメータの作成</h4>
    <pre class="code lang-scheme" data-lang="scheme" data-unlink><span class="synSpecial">(</span><span class="synStatement">define</span> x <span class="synSpecial">(</span>make-parameter <span class="synConstant">3</span><span class="synSpecial">))</span>
<span class="synSpecial">(</span>x<span class="synSpecial">)</span>     <span class="synComment">; =&gt; 3</span>
<span class="synSpecial">(</span>x <span class="synConstant">100</span><span class="synSpecial">)</span> <span class="synComment">; xの値を100に設定</span>
<span class="synSpecial">(</span>x<span class="synSpecial">)</span>     <span class="synComment">; =&gt; 100</span>
</pre><p>典型的な使い方としては、特定の関数が使用するデフォルトの値を設定する場合などに使えます。</p>
<pre class="code lang-scheme" data-lang="scheme" data-unlink><span class="synSpecial">(</span><span class="synStatement">define</span> <span class="synSpecial">(</span>my-make-vector<span class="synSpecial">)</span> <span class="synSpecial">(</span><span class="synIdentifier">make-vector</span> <span class="synSpecial">(</span>default-length<span class="synSpecial">)))</span>
<span class="synSpecial">(</span>my-make-vector<span class="synSpecial">)</span> <span class="synComment">; =&gt; 要素10個からなるvector</span>

<span class="synSpecial">(</span>default-length <span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span>my-make-vector<span class="synSpecial">)</span> <span class="synComment">; =&gt; 要素1個からなるvector</span>
</pre>
</div>
<div class="section">
    <h4>パラメータの値のフィルタリング</h4>
    <p>パラメータが取る値に制限を設けたい場合、make-parameterの第二引数にフィルターのようなものを指定できます。</p>
<pre class="code lang-scheme" data-lang="scheme" data-unlink><span class="synSpecial">(</span><span class="synStatement">define</span> default-length
  <span class="synSpecial">(</span>make-parameter <span class="synConstant">10</span> <span class="synSpecial">(</span>^<span class="synSpecial">(</span>size<span class="synSpecial">)</span>
                       <span class="synComment">;; sizeが0以下なら1をセットする</span>
                       <span class="synSpecial">(</span><span class="synStatement">if</span> <span class="synSpecial">(</span><span class="synIdentifier">&lt;=</span> size <span class="synConstant">0</span><span class="synSpecial">)</span> <span class="synConstant">1</span> size<span class="synSpecial">))))</span>
<span class="synSpecial">(</span>default-length<span class="synSpecial">)</span>   <span class="synComment">; =&gt; 10</span>
<span class="synSpecial">(</span>default-length <span class="synConstant">5</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span>default-length<span class="synSpecial">)</span>   <span class="synComment">; =&gt; 5</span>
<span class="synSpecial">(</span>default-length <span class="synConstant">0</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span>default-length<span class="synSpecial">)</span>   <span class="synComment">; =&gt; 1</span>
</pre>
</div>
<div class="section">
    <h4>パラメータの値の変化の監視</h4>
    <p>parameter-observer-add!を使うことで、パラメータに値がセットされる直前/された直後に特定の関数を実行することができるようになります。</p>
<pre class="code lang-scheme" data-lang="scheme" data-unlink><span class="synSpecial">(</span>default-length <span class="synConstant">10</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span>parameter-observer-add! default-length
                         <span class="synSpecial">(</span>^<span class="synSpecial">(</span>old new<span class="synSpecial">)</span>
                           <span class="synSpecial">(</span>print #<span class="synConstant">&quot;old: ~old, new: ~new&quot;</span><span class="synSpecial">))</span>
                         <span class="synSpecial">'</span>before<span class="synSpecial">)</span>
<span class="synSpecial">(</span>default-length <span class="synConstant">3</span><span class="synSpecial">)</span>
<span class="synComment">;; =&gt; old: 10, new: 3</span>
</pre>
</div>
<div class="section">
    <h4>局所的なパラメータの値の変更</h4>
    <p>また、局所的にパラメータの値を変更することもできます。</p>
<pre class="code lang-scheme" data-lang="scheme" data-unlink><span class="synSpecial">(</span>default-length <span class="synConstant">10</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span>parameterize <span class="synSpecial">((</span>default-length <span class="synConstant">5</span><span class="synSpecial">))</span>
  <span class="synComment">;; この中身を実行している時だけ(default-length)が5となる</span>
  <span class="synSpecial">(</span>my-make-vector<span class="synSpecial">))</span> <span class="synComment">; =&gt; 要素5個のvector</span>

<span class="synSpecial">(</span>default-length<span class="synSpecial">)</span> <span class="synComment">; =&gt; 10</span>
</pre>
</div>

{% endraw %}
