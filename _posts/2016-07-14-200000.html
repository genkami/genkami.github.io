---
layout: post
title: 型クラス自体を型として扱う
tags:
- Haskell

---
{% raw %}
<p>ConstraintKinds拡張を使うと、型定義の=>の左辺にくる制約そのものを型として扱うことができるようになります。</p>
<pre class="code lang-haskell" data-lang="haskell" data-unlink><span class="synSpecial">{-# LANGUAGE ConstraintKinds #-}</span>

<span class="synComment">-- ConstraintKinds拡張がなければこのような定義はできない</span>
<span class="synType">type</span> MyShow t <span class="synStatement">=</span> Show t

<span class="synComment">-- typeで定義した制約を=&gt;の左辺に書ける</span>
myShow <span class="synStatement">::</span> MyShow t <span class="synStatement">=&gt;</span> t <span class="synStatement">-&gt;</span> String
myShow <span class="synStatement">=</span> show
</pre><p>このとき、=>の左辺にくる制約は、kindが<a class="keyword" href="http://d.hatena.ne.jp/keyword/GHC">GHC</a>.Exts.Constraintであるような型として扱われます。</p>
<pre class="code lang-haskell" data-lang="haskell" data-unlink><span class="synStatement">&gt;&gt;&gt;</span> <span class="synStatement">:</span>k Show
Show <span class="synStatement">::</span> <span class="synStatement">*</span> <span class="synStatement">-&gt;</span> Constraint
</pre><p>また、kindがConstraintであるような型c1, c2, ., cnに対して、タプル(c1, c2, .., cn)もConstraintとして扱われます。</p>
<pre class="code lang-haskell" data-lang="haskell" data-unlink><span class="synComment">-- ConstraintのタプルもConstraint</span>
<span class="synType">type</span> ShowAndRead t <span class="synStatement">=</span> (Show t, Read t)

id' <span class="synStatement">::</span> ShowAndRead t <span class="synStatement">=&gt;</span> t <span class="synStatement">-&gt;</span> t
id' t <span class="synStatement">=</span> read <span class="synStatement">$</span> show t
</pre><p>さらに、Constraintは型として扱われるため、他の型やクラスの型引数として扱うこともできます。</p>
<pre class="code lang-haskell" data-lang="haskell" data-unlink><span class="synPreProc">import</span> GHC.Exts (Constraint)

<span class="synType">data</span> F (cls <span class="synStatement">::</span> <span class="synStatement">*</span> <span class="synStatement">-&gt;</span> Constraint) (a <span class="synStatement">::</span> <span class="synStatement">*</span>)
  <span class="synStatement">=</span> F (forall t<span class="synStatement">.</span> cls t <span class="synStatement">=&gt;</span> t <span class="synStatement">-&gt;</span> a)

hoge <span class="synStatement">::</span> F Show String
hoge <span class="synStatement">=</span> F show
</pre>

{% endraw %}
