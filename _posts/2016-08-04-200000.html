---
layout: post
title: named let
tags:
- Gauche

---
{% raw %}
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Gauche">Gauche</a>(に限らずほぼすべての<a class="keyword" href="http://d.hatena.ne.jp/keyword/LISP">LISP</a>)では、letは次のような<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%B7%A5%F3%A5%BF%A5%C3%A5%AF%A5%B9">シンタックス</a>シュガーとなっています。</p>
<pre class="code lang-scheme" data-lang="scheme" data-unlink><span class="synSpecial">(</span><span class="synStatement">let</span> <span class="synSpecial">((</span>hoge hoge-value<span class="synSpecial">)</span>
      <span class="synSpecial">(</span>fuga fuga-value<span class="synSpecial">))</span>
  <span class="synSpecial">(</span>some-function hoge fuga<span class="synSpecial">))</span>

<span class="synComment">;; ↓展開後</span>

<span class="synSpecial">((</span><span class="synStatement">lambda</span> <span class="synSpecial">(</span>hoge fuga<span class="synSpecial">)</span>
   <span class="synSpecial">(</span>some-function hoge fuga<span class="synSpecial">))</span>
   hoge-value fuga-value<span class="synSpecial">)</span>
</pre><p>このlambda自体に名前を付けて、<a class="keyword" href="http://d.hatena.ne.jp/keyword/%BA%C6%B5%A2">再帰</a>的に呼び出せるようにしたものがnamed letです。</p><p>これが何の役に立つかというと、例えば末尾<a class="keyword" href="http://d.hatena.ne.jp/keyword/%BA%C6%B5%A2">再帰</a>的な関数を簡単に書くことができるようになります。</p><br />
<p>試しに、lengthを自前で実装してみましょう。<br />
まずは通常の末尾<a class="keyword" href="http://d.hatena.ne.jp/keyword/%BA%C6%B5%A2">再帰</a>のバージョンから。</p>
<pre class="code lang-scheme" data-lang="scheme" data-unlink><span class="synSpecial">(</span><span class="synStatement">define</span> <span class="synSpecial">(</span>my-length lis<span class="synSpecial">)</span>
  <span class="synSpecial">(</span><span class="synStatement">define</span> <span class="synSpecial">(</span>my-length-rec xs n<span class="synSpecial">)</span>
    <span class="synSpecial">(</span><span class="synStatement">if</span> <span class="synSpecial">(</span><span class="synIdentifier">null?</span> xs<span class="synSpecial">)</span>
        n
        <span class="synSpecial">(</span>my-length-rec <span class="synSpecial">(</span><span class="synIdentifier">cdr</span> xs<span class="synSpecial">)</span> <span class="synSpecial">(</span><span class="synIdentifier">+</span> n <span class="synConstant">1</span><span class="synSpecial">))))</span>
  <span class="synSpecial">(</span>my-length-rec lis <span class="synConstant">0</span><span class="synSpecial">))</span>
</pre><p>これをnamed letを使って書き直すと、次のようになります。</p>
<pre class="code lang-scheme" data-lang="scheme" data-unlink><span class="synSpecial">(</span><span class="synStatement">define</span> <span class="synSpecial">(</span>my-length2 lis<span class="synSpecial">)</span>
  <span class="synSpecial">(</span><span class="synStatement">let</span> loop <span class="synSpecial">((</span>xs lis<span class="synSpecial">)</span>
             <span class="synSpecial">(</span>n <span class="synConstant">0</span><span class="synSpecial">))</span>
    <span class="synSpecial">(</span><span class="synStatement">if</span> <span class="synSpecial">(</span><span class="synIdentifier">null?</span> xs<span class="synSpecial">)</span>
        n
        <span class="synSpecial">(</span>loop <span class="synSpecial">(</span><span class="synIdentifier">cdr</span> xs<span class="synSpecial">)</span> <span class="synSpecial">(</span><span class="synIdentifier">+</span> n <span class="synConstant">1</span><span class="synSpecial">)))))</span>
</pre>

{% endraw %}
