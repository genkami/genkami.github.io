---
layout: post
title: M-x termのシェルの色をテーマに合わせる
tags:
- Emacs

---
{% raw %}
<p>まずはテーマの配色を調べます。</p><p>自分の環境(<a class="keyword" href="http://d.hatena.ne.jp/keyword/Ubuntu">Ubuntu</a>)では /usr/share/<a class="keyword" href="http://d.hatena.ne.jp/keyword/emacs">emacs</a>/24.5/etc/themes にテーマの<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>があったので、まずはそれを開いて配色を確認します。</p>
<pre class="code lang-lisp" data-lang="lisp" data-unlink><span class="synSpecial">(</span>deftheme misterioso
  <span class="synConstant">&quot;Predominantly blue/cyan faces on a dark cyan background.&quot;</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synStatement">let</span> <span class="synSpecial">((</span><span class="synStatement">class</span> <span class="synSpecial">'((</span><span class="synStatement">class</span> color<span class="synSpecial">)</span> <span class="synSpecial">(</span>min-colors 89<span class="synSpecial">))))</span>

  <span class="synSpecial">(</span>custom-theme-set-faces
   <span class="synSpecial">'</span><span class="synIdentifier">misterioso</span>
   <span class="synComment">;; Ensure sufficient contrast on 256-color xterms.</span>
   <span class="synPreProc">`(</span>default <span class="synSpecial">((((</span><span class="synStatement">class</span> color<span class="synSpecial">)</span> <span class="synSpecial">(</span>min-colors <span class="synConstant">4096</span><span class="synSpecial">))</span>
	       <span class="synSpecial">(</span>:background <span class="synConstant">&quot;#2d3743&quot;</span> :foreground <span class="synConstant">&quot;#e1e1e0&quot;</span><span class="synSpecial">))</span>
	      <span class="synSpecial">(</span>,<span class="synStatement">class</span>
	       <span class="synSpecial">(</span>:background <span class="synConstant">&quot;#3a3a3a&quot;</span> :foreground <span class="synConstant">&quot;#e1e1e0&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synPreProc">`(</span>cursor <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:background <span class="synConstant">&quot;#415160&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synComment">;; Highlighting faces</span>
   <span class="synPreProc">`(</span>fringe <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:background <span class="synConstant">&quot;#2e3748&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synPreProc">`(</span>highlight <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:background <span class="synConstant">&quot;#338f86&quot;</span> :foreground <span class="synConstant">&quot;#e1e1e0&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synPreProc">`(</span>region <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:background <span class="synConstant">&quot;#2d4948&quot;</span> :foreground <span class="synConstant">&quot;#e1e1e0&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synPreProc">`(</span>isearch <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:background <span class="synConstant">&quot;#fcffad&quot;</span> :foreground <span class="synConstant">&quot;#000000&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synPreProc">`(</span>lazy-highlight <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:background <span class="synConstant">&quot;#338f86&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synPreProc">`(</span>trailing-whitespace <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:background <span class="synConstant">&quot;#ff4242&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synComment">;; Mode line faces</span>
   <span class="synPreProc">`(</span>mode-line <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:background <span class="synConstant">&quot;#212931&quot;</span> :foreground <span class="synConstant">&quot;#eeeeec&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synPreProc">`(</span>mode-line-inactive
     <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:background <span class="synConstant">&quot;#878787&quot;</span> :foreground <span class="synConstant">&quot;#eeeeec&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synPreProc">`(</span>header-line <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:background <span class="synConstant">&quot;#e5e5e5&quot;</span> :foreground <span class="synConstant">&quot;#333333&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synComment">;; Escape and prompt faces</span>
   <span class="synPreProc">`(</span>minibuffer-prompt <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;#729fcf&quot;</span> :weight bold<span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synComment">;; Font lock faces</span>
   <span class="synPreProc">`(</span>font-lock-builtin-face <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;#23d7d7&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synPreProc">`(</span>font-lock-comment-face <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;#74af68&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synPreProc">`(</span>font-lock-constant-face <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;#008b8b&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synPreProc">`(</span>font-lock-function-name-face
     <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;#00ede1&quot;</span> :weight bold<span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synPreProc">`(</span>font-lock-keyword-face <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;#ffad29&quot;</span> :weight bold<span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synPreProc">`(</span>font-lock-string-face <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;#e67128&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synPreProc">`(</span>font-lock-type-face <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;#34cae2&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synPreProc">`(</span>font-lock-variable-name-face <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;#dbdb95&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synPreProc">`(</span>font-lock-warning-face <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;#ff4242&quot;</span> :weight bold<span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synComment">;; Buttons and links</span>
   <span class="synPreProc">`(</span>button <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:underline <span class="synStatement">t</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synPreProc">`(</span>link <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;#59e9ff&quot;</span> :underline <span class="synStatement">t</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synPreProc">`(</span>link-visited <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;#ed74cd&quot;</span> :underline <span class="synStatement">t</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
    ... <span class="synSpecial">(</span>中略<span class="synSpecial">)</span>
   <span class="synPreProc">`(</span>message-cited-text <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;#74af68&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
   <span class="synPreProc">`(</span>message-separator <span class="synSpecial">((</span>,<span class="synStatement">class</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;#23d7d7&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span><span class="synSpecial">))</span>

<span class="synSpecial">(</span>custom-theme-set-variables
 <span class="synSpecial">'</span><span class="synIdentifier">misterioso</span>
 <span class="synSpecial">'(</span>ansi-color-names-vector [<span class="synConstant">&quot;#2d3743&quot;</span> <span class="synConstant">&quot;#ff4242&quot;</span> <span class="synConstant">&quot;#74af68&quot;</span> <span class="synConstant">&quot;#dbdb95&quot;</span>
			    <span class="synConstant">&quot;#34cae2&quot;</span> <span class="synConstant">&quot;#008b8b&quot;</span> <span class="synConstant">&quot;#00ede1&quot;</span> <span class="synConstant">&quot;#e1e1e0&quot;</span>]<span class="synSpecial">))</span>

<span class="synSpecial">(</span>provide-theme <span class="synSpecial">'</span><span class="synIdentifier">misterioso</span><span class="synSpecial">)</span>
</pre><p>下の方に<a class="keyword" href="http://d.hatena.ne.jp/keyword/ansi">ansi</a>-term用の配色の設定がされているのですが、どうもテーマの色ともあわないし、若干見づらいものとなっています。<br />
個人的には通常の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>のハイライトと似たような配色にしてほしいので、上の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%BD%A1%BC%A5%B9%A5%B3%A1%BC%A5%C9">ソースコード</a>を見ながら、適当に近い色を設定していきます。</p>
<pre class="code lang-lisp" data-lang="lisp" data-unlink><span class="synSpecial">(</span>custom-theme-set-faces
 <span class="synSpecial">'</span><span class="synIdentifier">misterioso</span>
 <span class="synComment">;; `(term-color-black ((t (:foreground &quot;&quot;))))</span>
 <span class="synPreProc">`(</span>term-color-red <span class="synSpecial">((</span><span class="synStatement">t</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;#e67128&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
 <span class="synPreProc">`(</span>term-color-green <span class="synSpecial">((</span><span class="synStatement">t</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;#74af68&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
 <span class="synPreProc">`(</span>term-color-yellow <span class="synSpecial">((</span><span class="synStatement">t</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;#ffad29&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
 <span class="synPreProc">`(</span>term-color-blue <span class="synSpecial">((</span><span class="synStatement">t</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;#34cae2&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
 <span class="synPreProc">`(</span>term-color-magenta <span class="synSpecial">((</span><span class="synStatement">t</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;#9c1b91&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
 <span class="synPreProc">`(</span>term-color-cyan <span class="synSpecial">((</span><span class="synStatement">t</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;#00ede1&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
 <span class="synPreProc">`(</span>term-color-white <span class="synSpecial">((</span><span class="synStatement">t</span> <span class="synSpecial">(</span>:foreground <span class="synConstant">&quot;white&quot;</span><span class="synSpecial">)))</span><span class="synPreProc">)</span>
 <span class="synSpecial">)</span>
</pre><p>テーマにない色は適当に近いものを設定しました。</p><p>これでいくらかマシになったはず。</p>


{% endraw %}
