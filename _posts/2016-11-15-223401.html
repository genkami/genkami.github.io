---
layout: post
title: Coqで定理の特定の項だけを書き換える
tags:
- Coq

---
{% raw %}
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/rewrite">rewrite</a>やsimplを使って定理を書き換えようとすると、どうしても思ったとおりに書き換えがいかないことがあります。</p>
<pre class="code" data-lang="" data-unlink>(* 結合法則と交換法則を使って、3つの項を入れ替える *)
Goal forall (T : Type) (op : T -&gt; T -&gt; T),
       (forall x y z : T, op (op x y) z = (op x (op y z))) -&gt;
       (forall x y : T, op x y = op y x) -&gt;
       (forall x y z : T, op (op x y) z = op (op z y) x).
Proof.
  intros T op assoc comm.
  intros x y z.
  (* Goal: op (op x y) z = op (op z y) x *)
  rewrite -&gt; assoc. (* op (op z y) x -&gt; op z (op y x) したい *)
  (* Goal: op x (op y z) = op (op z y) x になってしまった……。 *)
Abort. (* 本当はこの状態からでも証明はできるが、思ったとおりにいかなかったのでとりあえずAbort *)</pre><p>こういった場合は、replaceタクティックを使うとうまく行きます。</p>
<pre class="code" data-lang="" data-unlink>rewrite hoge with fuga.</pre><p>このタクティックはゴール中の項<a class="keyword" href="http://d.hatena.ne.jp/keyword/hoge">hoge</a>を、すべてfugaで置き換えてくれます。<br />
そうして書き換わったゴールを証明したあと、今度は<a class="keyword" href="http://d.hatena.ne.jp/keyword/hoge">hoge</a> = fugaであることの証明を行います。</p>
<pre class="code" data-lang="" data-unlink>Goal forall (T : Type) (op : T -&gt; T -&gt; T),
       (forall x y z : T, op (op x y) z = (op x (op y z))) -&gt;
       (forall x y : T, op x y = op y x) -&gt;
       (forall x y z : T, op (op x y) z = op (op z y) x).
Proof.
  intros T op assoc comm.
  intros x y z.
  (* Goal: op (op x y) z = op (op z y) x *)
  replace (op (op z y) x) with (op z (op y x)).
  (* Goal: op (op x y) z = op z (op y x) *)
  replace (op y x) with (op x y).
  (* Goal: op (op x y) z = op z (op x y) *)
  replace (op z (op x y)) with (op (op x y) z).
  reflexivity.
  - (* op (op x y) z = op z (op x y) の証明 *)
    apply comm.
  - (* op x y = op y x の証明 *)
    apply comm.
  - (* op z (op y x) = op (op z y) x の証明 *)
    rewrite -&gt; assoc.
    reflexivity.
Qed.</pre><p>また、replace <a class="keyword" href="http://d.hatena.ne.jp/keyword/hoge">hoge</a> with fuga in Hを使うことによって、ゴールではなく前提H内の項を書き換えることもできます。</p>
<pre class="code" data-lang="" data-unlink>Goal forall (T : Type) (x y : T) (P : T -&gt; T -&gt; Prop),
       x = y -&gt; P x y -&gt; P y y.
Proof.
  intros T x y P xisy Pxy. (* xisy : x = y, Pxy : P x y *)
  replace x with y in Pxy. (* Pxy: P y y に書き換わる *)
  apply Pxy.
Qed</pre>

{% endraw %}
