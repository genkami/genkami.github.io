---
layout: post
title: Gaucheでハノイの塔
tags:
- Gauche

---
{% raw %}
<p><a class="keyword" href="http://d.hatena.ne.jp/keyword/Gauche">Gauche</a>の練習。</p><p>n個の<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%CF%A5%CE%A5%A4">ハノイ</a>の塔の解き方を表示するプログラムです。<br />
各板の大きさは数値として表され、数値が大きい方が大きい板となっています。<br />
また、見やすさのため表示する際はリストの逆順(右のほうが塔の上側)となっています。</p>
<pre class="code lang-scheme" data-lang="scheme" data-unlink><span class="synSpecial">(</span>use gauche.array<span class="synSpecial">)</span>

<span class="synComment">;; n個のハノイの塔の解き方を表示する。</span>
<span class="synSpecial">(</span><span class="synStatement">define</span> <span class="synSpecial">(</span>hanoi n<span class="synSpecial">)</span>
  <span class="synSpecial">(</span><span class="synStatement">define</span> towers <span class="synSpecial">(</span>array <span class="synSpecial">(</span>shape <span class="synConstant">0</span> <span class="synConstant">3</span><span class="synSpecial">)</span> <span class="synSpecial">(</span>iota n <span class="synConstant">1</span> <span class="synConstant">1</span><span class="synSpecial">)</span> <span class="synSpecial">'()</span> <span class="synSpecial">'()))</span>
  <span class="synSpecial">(</span><span class="synStatement">define</span> <span class="synSpecial">(</span>tower-get i<span class="synSpecial">)</span> <span class="synSpecial">(</span>array-ref towers i<span class="synSpecial">))</span>
  <span class="synSpecial">(</span><span class="synStatement">define</span> <span class="synSpecial">(</span>tower-set! i val<span class="synSpecial">)</span> <span class="synSpecial">(</span>array-set! towers i val<span class="synSpecial">))</span>
  <span class="synComment">;; 現在のハノイの塔を見て、1つでも小さい板の上に大きい板が乗っていたものがあった場合死ぬ</span>
  <span class="synSpecial">(</span><span class="synStatement">define</span> <span class="synSpecial">(</span>assert-towers<span class="synSpecial">)</span>
    <span class="synSpecial">(</span><span class="synIdentifier">map</span> assert-tower <span class="synSpecial">'(</span><span class="synConstant">0</span> <span class="synConstant">1</span> <span class="synConstant">2</span><span class="synSpecial">)))</span>
  <span class="synComment">;; i番目のハノイの塔を見て、</span>
  <span class="synComment">;; 小さい板の上に大きい板が乗っていた場合死ぬ</span>
  <span class="synSpecial">(</span><span class="synStatement">define</span> <span class="synSpecial">(</span>assert-tower i<span class="synSpecial">)</span>
    <span class="synSpecial">(</span><span class="synStatement">define</span> <span class="synSpecial">(</span>loop xs<span class="synSpecial">)</span>
      <span class="synSpecial">(</span><span class="synStatement">cond</span>
       <span class="synSpecial">((</span><span class="synIdentifier">null?</span> xs<span class="synSpecial">)</span> <span class="synConstant">#f</span><span class="synSpecial">)</span>
       <span class="synSpecial">((</span><span class="synIdentifier">null?</span> <span class="synSpecial">(</span><span class="synIdentifier">cdr</span> xs<span class="synSpecial">))</span> <span class="synConstant">#f</span><span class="synSpecial">)</span>
       <span class="synSpecial">(</span><span class="synStatement">else</span>
        <span class="synSpecial">(</span><span class="synStatement">let</span> <span class="synSpecial">((</span>x <span class="synSpecial">(</span><span class="synIdentifier">car</span> xs<span class="synSpecial">))</span>
              <span class="synSpecial">(</span>y <span class="synSpecial">(</span><span class="synIdentifier">cadr</span> xs<span class="synSpecial">))</span>
              <span class="synSpecial">(</span>rest <span class="synSpecial">(</span><span class="synIdentifier">cddr</span> xs<span class="synSpecial">)))</span>
          <span class="synSpecial">(</span><span class="synStatement">if</span> <span class="synSpecial">(</span><span class="synIdentifier">&gt;</span> x y<span class="synSpecial">)</span>
              <span class="synSpecial">(</span>raise <span class="synConstant">&quot;you don't know rules?????????????????&quot;</span><span class="synSpecial">)</span>
              <span class="synSpecial">(</span>loop rest<span class="synSpecial">))))))</span>
    <span class="synSpecial">(</span>loop <span class="synSpecial">(</span>tower-get i<span class="synSpecial">)))</span>
  <span class="synSpecial">(</span><span class="synStatement">define</span> <span class="synSpecial">(</span>print-tower<span class="synSpecial">)</span>
    <span class="synSpecial">(</span><span class="synIdentifier">display</span> <span class="synSpecial">(</span><span class="synIdentifier">reverse</span> <span class="synSpecial">(</span>tower-get <span class="synConstant">0</span><span class="synSpecial">)))</span>
    <span class="synSpecial">(</span><span class="synIdentifier">newline</span><span class="synSpecial">)</span>
    <span class="synSpecial">(</span><span class="synIdentifier">display</span> <span class="synSpecial">(</span><span class="synIdentifier">reverse</span> <span class="synSpecial">(</span>tower-get <span class="synConstant">1</span><span class="synSpecial">)))</span>
    <span class="synSpecial">(</span><span class="synIdentifier">newline</span><span class="synSpecial">)</span>
    <span class="synSpecial">(</span><span class="synIdentifier">display</span> <span class="synSpecial">(</span><span class="synIdentifier">reverse</span> <span class="synSpecial">(</span>tower-get <span class="synConstant">2</span><span class="synSpecial">)))</span>
    <span class="synSpecial">(</span><span class="synIdentifier">newline</span><span class="synSpecial">)</span>
    <span class="synSpecial">(</span><span class="synIdentifier">newline</span><span class="synSpecial">))</span>
  <span class="synComment">;; a番目の塔の先頭m個をb番目の塔に移動する</span>
  <span class="synSpecial">(</span><span class="synStatement">define</span> <span class="synSpecial">(</span>inner-hanoi m a b c<span class="synSpecial">)</span>
    <span class="synSpecial">(</span><span class="synStatement">if</span> <span class="synSpecial">(</span><span class="synIdentifier">=</span> m <span class="synConstant">1</span><span class="synSpecial">)</span>
        <span class="synSpecial">(</span><span class="synStatement">begin</span>
          <span class="synSpecial">(</span>tower-set! b <span class="synSpecial">(</span><span class="synIdentifier">cons</span> <span class="synSpecial">(</span><span class="synIdentifier">car</span> <span class="synSpecial">(</span>tower-get a<span class="synSpecial">))</span> <span class="synSpecial">(</span>tower-get b<span class="synSpecial">)))</span>
          <span class="synSpecial">(</span>tower-set! a <span class="synSpecial">(</span><span class="synIdentifier">cdr</span> <span class="synSpecial">(</span>tower-get a<span class="synSpecial">)))</span>
          <span class="synSpecial">(</span>assert-towers<span class="synSpecial">)</span>
          <span class="synSpecial">(</span>print-tower<span class="synSpecial">))</span>
        <span class="synSpecial">(</span><span class="synStatement">begin</span>
          <span class="synSpecial">(</span>inner-hanoi <span class="synSpecial">(</span><span class="synIdentifier">-</span> m <span class="synConstant">1</span><span class="synSpecial">)</span> a c b<span class="synSpecial">)</span>
          <span class="synSpecial">(</span>tower-set! b <span class="synSpecial">(</span><span class="synIdentifier">cons</span> <span class="synSpecial">(</span><span class="synIdentifier">car</span> <span class="synSpecial">(</span>tower-get a<span class="synSpecial">))</span> <span class="synSpecial">(</span>tower-get b<span class="synSpecial">)))</span>
          <span class="synSpecial">(</span>tower-set! a <span class="synSpecial">(</span><span class="synIdentifier">cdr</span> <span class="synSpecial">(</span>tower-get a<span class="synSpecial">)))</span>
          <span class="synSpecial">(</span>assert-towers<span class="synSpecial">)</span>
          <span class="synSpecial">(</span>print-tower<span class="synSpecial">)</span>
          <span class="synSpecial">(</span>inner-hanoi <span class="synSpecial">(</span><span class="synIdentifier">-</span> m <span class="synConstant">1</span><span class="synSpecial">)</span> c b a<span class="synSpecial">))))</span>
  <span class="synSpecial">(</span>print-tower<span class="synSpecial">)</span>
  <span class="synSpecial">(</span>inner-hanoi n <span class="synConstant">0</span> <span class="synConstant">1</span> <span class="synConstant">2</span><span class="synSpecial">))</span>
</pre><p>1つコマを動かすごとにassert-towersで不正な操作がなかったか確認しているので、エラーなく終了したということはすべての手順が<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%CF%A5%CE%A5%A4">ハノイ</a>の塔のルールを満たしていることになります。</p><p>実行例</p>
<pre class="code lang-scheme" data-lang="scheme" data-unlink>gosh&gt; <span class="synSpecial">(</span>hanoi <span class="synConstant">3</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">3</span> <span class="synConstant">2</span> <span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">()</span>
<span class="synSpecial">()</span>

<span class="synSpecial">(</span><span class="synConstant">3</span> <span class="synConstant">2</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">()</span>

<span class="synSpecial">(</span><span class="synConstant">3</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">2</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">3</span><span class="synSpecial">)</span>
<span class="synSpecial">()</span>
<span class="synSpecial">(</span><span class="synConstant">2</span> <span class="synConstant">1</span><span class="synSpecial">)</span>

<span class="synSpecial">()</span>
<span class="synSpecial">(</span><span class="synConstant">3</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">2</span> <span class="synConstant">1</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">3</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">2</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">3</span> <span class="synConstant">2</span><span class="synSpecial">)</span>
<span class="synSpecial">()</span>

<span class="synSpecial">()</span>
<span class="synSpecial">(</span><span class="synConstant">3</span> <span class="synConstant">2</span> <span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">()</span>

<span class="synError">#&lt;undef&gt;</span>
</pre><pre class="code lang-scheme" data-lang="scheme" data-unlink>gosh&gt; <span class="synSpecial">(</span>hanoi <span class="synConstant">5</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">4</span> <span class="synConstant">3</span> <span class="synConstant">2</span> <span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">()</span>
<span class="synSpecial">()</span>

<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">4</span> <span class="synConstant">3</span> <span class="synConstant">2</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">()</span>

<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">4</span> <span class="synConstant">3</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">2</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">4</span> <span class="synConstant">3</span><span class="synSpecial">)</span>
<span class="synSpecial">()</span>
<span class="synSpecial">(</span><span class="synConstant">2</span> <span class="synConstant">1</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">4</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">3</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">2</span> <span class="synConstant">1</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">4</span> <span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">3</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">2</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">4</span> <span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">3</span> <span class="synConstant">2</span><span class="synSpecial">)</span>
<span class="synSpecial">()</span>

<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">4</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">3</span> <span class="synConstant">2</span> <span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">()</span>

<span class="synSpecial">(</span><span class="synConstant">5</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">3</span> <span class="synConstant">2</span> <span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">4</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">5</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">3</span> <span class="synConstant">2</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">4</span> <span class="synConstant">1</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">2</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">3</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">4</span> <span class="synConstant">1</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">2</span> <span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">3</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">4</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">2</span> <span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">()</span>
<span class="synSpecial">(</span><span class="synConstant">4</span> <span class="synConstant">3</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">2</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">4</span> <span class="synConstant">3</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">5</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">4</span> <span class="synConstant">3</span> <span class="synConstant">2</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">5</span><span class="synSpecial">)</span>
<span class="synSpecial">()</span>
<span class="synSpecial">(</span><span class="synConstant">4</span> <span class="synConstant">3</span> <span class="synConstant">2</span> <span class="synConstant">1</span><span class="synSpecial">)</span>

<span class="synSpecial">()</span>
<span class="synSpecial">(</span><span class="synConstant">5</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">4</span> <span class="synConstant">3</span> <span class="synConstant">2</span> <span class="synConstant">1</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">5</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">4</span> <span class="synConstant">3</span> <span class="synConstant">2</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">2</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">4</span> <span class="synConstant">3</span><span class="synSpecial">)</span>

<span class="synSpecial">()</span>
<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">2</span> <span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">4</span> <span class="synConstant">3</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">3</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">2</span> <span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">4</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">3</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">2</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">4</span> <span class="synConstant">1</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">3</span> <span class="synConstant">2</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">5</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">4</span> <span class="synConstant">1</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">3</span> <span class="synConstant">2</span> <span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">5</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">4</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">3</span> <span class="synConstant">2</span> <span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">4</span><span class="synSpecial">)</span>
<span class="synSpecial">()</span>

<span class="synSpecial">(</span><span class="synConstant">3</span> <span class="synConstant">2</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">4</span> <span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">()</span>

<span class="synSpecial">(</span><span class="synConstant">3</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">4</span> <span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">2</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">3</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">4</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">2</span> <span class="synConstant">1</span><span class="synSpecial">)</span>

<span class="synSpecial">()</span>
<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">4</span> <span class="synConstant">3</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">2</span> <span class="synConstant">1</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">4</span> <span class="synConstant">3</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">2</span><span class="synSpecial">)</span>

<span class="synSpecial">(</span><span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">4</span> <span class="synConstant">3</span> <span class="synConstant">2</span><span class="synSpecial">)</span>
<span class="synSpecial">()</span>

<span class="synSpecial">()</span>
<span class="synSpecial">(</span><span class="synConstant">5</span> <span class="synConstant">4</span> <span class="synConstant">3</span> <span class="synConstant">2</span> <span class="synConstant">1</span><span class="synSpecial">)</span>
<span class="synSpecial">()</span>

<span class="synError">#&lt;undef&gt;</span>
</pre>

{% endraw %}
