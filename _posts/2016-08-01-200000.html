---
layout: post
title: Gaucheでパターンマッチ
tags:
- Gauche

---
{% raw %}
<p>util.matchモジュールを使えば、<a class="keyword" href="http://d.hatena.ne.jp/keyword/Gauche">Gauche</a>でも<a class="keyword" href="http://d.hatena.ne.jp/keyword/Haskell">Haskell</a>のようなパターンマッチを行うことができます。</p>

<div class="section">
    <h4><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EA%A5%C6%A5%E9%A5%EB">リテラル</a>に対するパターンマッチ</h4>
    <p><a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EA%A5%C6%A5%E9%A5%EB">リテラル</a>に対するパターンは、その<a class="keyword" href="http://d.hatena.ne.jp/keyword/%A5%EA%A5%C6%A5%E9%A5%EB">リテラル</a>を直接書けばOKです。</p>
<pre class="code lang-scheme" data-lang="scheme" data-unlink><span class="synSpecial">(</span>use util.match<span class="synSpecial">)</span>
<span class="synSpecial">(</span><span class="synStatement">define</span> <span class="synSpecial">(</span>fact n<span class="synSpecial">)</span>
  <span class="synSpecial">(</span>match n
         <span class="synSpecial">(</span><span class="synConstant">0</span> <span class="synConstant">1</span><span class="synSpecial">)</span>
         <span class="synSpecial">(</span>n <span class="synSpecial">(</span><span class="synIdentifier">*</span> n <span class="synSpecial">(</span>fact <span class="synSpecial">(</span><span class="synIdentifier">-</span> n <span class="synConstant">1</span><span class="synSpecial">))))))</span>
<span class="synSpecial">(</span>fact <span class="synConstant">5</span><span class="synSpecial">)</span> <span class="synComment">; =&gt; 120</span>
</pre>
</div>
<div class="section">
    <h4>ペア、リストに対するパターンマッチ</h4>
    <p>ペアとリストに関しては、比較的直感的にパターンを記述することができます。</p>
<pre class="code lang-scheme" data-lang="scheme" data-unlink><span class="synSpecial">(</span><span class="synStatement">define</span> <span class="synSpecial">(</span>head xs<span class="synSpecial">)</span>
  <span class="synSpecial">(</span>match xs
         <span class="synSpecial">(()</span> <span class="synSpecial">(</span>error <span class="synConstant">&quot;empty list&quot;</span><span class="synSpecial">))</span>
         <span class="synSpecial">((</span>x rest ...<span class="synSpecial">)</span> x<span class="synSpecial">)))</span>

<span class="synSpecial">(</span>head <span class="synSpecial">'(</span><span class="synConstant">1</span> <span class="synConstant">2</span> <span class="synConstant">3</span> <span class="synConstant">4</span> <span class="synConstant">5</span> <span class="synConstant">6</span><span class="synSpecial">))</span> <span class="synComment">; =&gt; 1</span>
<span class="synSpecial">(</span>head <span class="synSpecial">'())</span>            <span class="synComment">; =&gt; ERROR: empty list</span>
</pre><p>上のheadは次のように書くこともできます。</p>
<pre class="code lang-scheme" data-lang="scheme" data-unlink><span class="synSpecial">(</span><span class="synStatement">define</span> <span class="synSpecial">(</span>head2 xs<span class="synSpecial">)</span>
  <span class="synSpecial">(</span>match xs
         <span class="synSpecial">(()</span> <span class="synSpecial">(</span>error <span class="synConstant">&quot;empty list&quot;</span><span class="synSpecial">))</span>
         <span class="synSpecial">((</span>x <span class="synSpecial">.</span> rest<span class="synSpecial">)</span> x<span class="synSpecial">)))</span>
</pre><p>もちろん(x . rest)はxとrestのペアを表すパターンなので、ペアに対してマッチさせることもできます。</p>
<pre class="code lang-scheme" data-lang="scheme" data-unlink><span class="synSpecial">(</span><span class="synStatement">define</span> <span class="synSpecial">(</span>norm p<span class="synSpecial">)</span>
  <span class="synSpecial">(</span>match p
         <span class="synSpecial">((</span>x <span class="synSpecial">.</span> y<span class="synSpecial">)</span> <span class="synSpecial">(</span><span class="synIdentifier">sqrt</span> <span class="synSpecial">(</span><span class="synIdentifier">+</span> <span class="synSpecial">(</span><span class="synIdentifier">expt</span> x <span class="synConstant">2</span><span class="synSpecial">)</span> <span class="synSpecial">(</span><span class="synIdentifier">expt</span> y <span class="synConstant">2</span><span class="synSpecial">))))))</span>

<span class="synSpecial">(</span><span class="synStatement">define</span> p <span class="synSpecial">(</span><span class="synIdentifier">cons</span> <span class="synConstant">3</span> <span class="synConstant">2</span><span class="synSpecial">))</span>

<span class="synSpecial">(</span>norm p<span class="synSpecial">)</span> <span class="synComment">; =&gt; 3.6055...</span>
</pre>
</div>
<div class="section">
    <h4>クラスに対するパターンマッチ</h4>
    <p>クラスに対しても$という特殊な記号を使うことでパターンマッチを行うことができます。</p>
<pre class="code lang-scheme" data-lang="scheme" data-unlink><span class="synSpecial">(</span>define-class <span class="synConstant">&lt;just&gt;</span> <span class="synSpecial">()</span>
  <span class="synSpecial">((</span>value :init-keyword :value<span class="synSpecial">)))</span>
<span class="synSpecial">(</span>define-class <span class="synConstant">&lt;nothing&gt;</span> <span class="synSpecial">()</span> <span class="synSpecial">())</span>

<span class="synSpecial">(</span><span class="synStatement">define</span> <span class="synSpecial">(</span>get-name maybe-name<span class="synSpecial">)</span>
  <span class="synSpecial">(</span>match maybe-name
         <span class="synSpecial">((</span>$ <span class="synConstant">&lt;just&gt;</span> name<span class="synSpecial">)</span> name<span class="synSpecial">)</span>
         <span class="synSpecial">((</span>$ <span class="synConstant">&lt;nothing&gt;</span><span class="synSpecial">)</span> <span class="synConstant">&quot;Anonymous&quot;</span><span class="synSpecial">)))</span>

<span class="synSpecial">(</span>get-name <span class="synSpecial">(</span>make <span class="synConstant">&lt;just&gt;</span> :value <span class="synConstant">&quot;Taro&quot;</span><span class="synSpecial">))</span> <span class="synComment">; =&gt; &quot;Taro&quot;</span>
<span class="synSpecial">(</span>get-name <span class="synSpecial">(</span>make <span class="synConstant">&lt;nothing&gt;</span><span class="synSpecial">))</span>            <span class="synComment">; =&gt; &quot;Anonymous&quot;</span>
</pre><p>また、@という記号を用いることでクラスのスロット名を指定してパターンマッチを行うこともできます。</p>
<pre class="code lang-scheme" data-lang="scheme" data-unlink><span class="synSpecial">(</span>define-class <span class="synConstant">&lt;point&gt;</span> <span class="synSpecial">()</span>
  <span class="synSpecial">((</span>x :init-keyword :x<span class="synSpecial">)</span>
   <span class="synSpecial">(</span>y :init-keyword :y<span class="synSpecial">)))</span>

<span class="synSpecial">(</span><span class="synStatement">define</span> <span class="synSpecial">(</span>point-norm p<span class="synSpecial">)</span>
  <span class="synSpecial">(</span>match p
         <span class="synSpecial">((</span>@ <span class="synConstant">&lt;point&gt;</span> <span class="synSpecial">(</span>x x-value<span class="synSpecial">)</span> <span class="synSpecial">(</span>y y-value<span class="synSpecial">))</span>
          <span class="synSpecial">(</span><span class="synIdentifier">sqrt</span> <span class="synSpecial">(</span><span class="synIdentifier">+</span> <span class="synSpecial">(</span><span class="synIdentifier">expt</span> x-value <span class="synConstant">2</span><span class="synSpecial">)</span> <span class="synSpecial">(</span><span class="synIdentifier">expt</span> y-value <span class="synConstant">2</span><span class="synSpecial">))))))</span>

<span class="synSpecial">(</span><span class="synStatement">define</span> p <span class="synSpecial">(</span>make <span class="synConstant">&lt;point&gt;</span> :x <span class="synConstant">5</span> :y <span class="synConstant">5</span><span class="synSpecial">))</span>

<span class="synSpecial">(</span>point-norm p<span class="synSpecial">)</span> <span class="synComment">; =&gt; 7.0710...</span>
</pre>
</div>
<div class="section">
    <h4>その他のマクロ</h4>
    <p>他にも、代入の左辺をパターンにできるmatch-letや、引数をパターンにできるmatch-define, match-lambdaなどがあります。</p>

</div>
<div class="section">
    <h4>参考</h4>
    <p><a href="http://practical-scheme.net/gauche/man/gauche-refj_203.html">Gauche &#x30E6;&#x30FC;&#x30B6;&#x30EA;&#x30D5;&#x30A1;&#x30EC;&#x30F3;&#x30B9;: 12.54 util.match - &#x30D1;&#x30BF;&#x30FC;&#x30F3;&#x30DE;&#x30C3;&#x30C1;&#x30F3;&#x30B0;</a></p>

</div>

{% endraw %}
